comprehensive fsockopen-based HTTP request function,support GET,POST,POST with file,raw POST,POST with specified IP etc. 

kkk
<style>
.com {color: #880000;}
.pun {color: #666600;}
.pln {color: #000000;}
.lit {color: #006666;}
.str {color: #008800;}
.prettyprint {background-color: #EEEEEE;max-width: 70em;}
</style>
<p>post_to_host.php replace curl with fsockopen: </p><pre class="prettyprint"><span class="com">//GET:</span><span class="pln"><br>$str_rtn</span><span class="pun">=</span><span class="pln">post_to_host</span><span class="pun">(</span><span class="pln">$str_url_target</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(),</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">,</span><span class="pln"> </span><span class="lit">0</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//POST:</span><span class="pln"><br>$arr_params</span><span class="pun">=</span><span class="pln">array</span><span class="pun">(</span><span class="str">'para1'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'para2'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">);</span><span class="pln"><br>$str_rtn</span><span class="pun">=</span><span class="pln">post_to_host</span><span class="pun">(</span><span class="pln">$str_url_target</span><span class="pun">,</span><span class="pln"> $arr_params</span><span class="pun">,</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//POST with file:</span><span class="pln"><br>$arr_params</span><span class="pun">=</span><span class="pln">array</span><span class="pun">(</span><span class="str">'para1'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'FILE:para2'</span><span class="pun">=&gt;</span><span class="str">'/tmp/test.jpg'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'para3'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">);</span><span class="pln"><br>$str_rtn</span><span class="pun">=</span><span class="pln">post_to_host</span><span class="pun">(</span><span class="pln">$str_url_target</span><span class="pun">,</span><span class="pln"> $arr_params</span><span class="pun">,</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">,</span><span class="pln"> </span><span class="lit">2</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//raw POST with file:</span><span class="pln"><br>$str_rtn</span><span class="pun">=</span><span class="pln">post_to_host</span><span class="pun">(</span><span class="pln">$str_url_target</span><span class="pun">,</span><span class="pln"> array</span><span class="pun">(</span><span class="str">'/tmp/test.jpg'</span><span class="pun">),</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//get cookie and merge cookies:</span><span class="pln"><br>$arr_new_cookie</span><span class="pun">=</span><span class="pln">get_cookies_from_heads</span><span class="pun">(</span><span class="pln">$ref_arr_head</span><span class="pun">)+</span><span class="pln">$arr_old_cookie</span><span class="pun">;</span><span class="com">//don't change the order</span><span class="pln"><br><br></span><span class="com">//get redirect url:</span><span class="pln"><br>$str_url_redirect</span><span class="pun">=</span><span class="pln">get_from_heads</span><span class="pun">(</span><span class="pln">$ref_arr_head</span><span class="pun">,</span><span class="pln"> </span><span class="str">'Location'</span><span class="pun">);</span></pre><pre class="prettyprint"><span class="com">//raw POST with custom headers:</span><span class="pln"><br>$str_file_name</span><span class="pun">=</span><span class="pln">array_search</span><span class="pun">(</span><span class="str">'uri'</span><span class="pun">,</span><span class="pln"> </span><span class="lit">@array_flip</span><span class="pun">(</span><span class="pln">stream_get_meta_data</span><span class="pun">(</span><span class="pln">$GLOBALS</span><span class="pun">[</span><span class="pln">mt_rand</span><span class="pun">()]=</span><span class="pln">tmpfile</span><span class="pun">())));</span><span class="pln"><br>$arr_params</span><span class="pun">=</span><span class="pln">array</span><span class="pun">(</span><span class="str">'para1'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'para2'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">);</span><span class="pln"><br>file_put_contents</span><span class="pun">(</span><span class="pln">$str_file_name</span><span class="pun">,</span><span class="pln"> json_encode</span><span class="pun">(</span><span class="pln">$arr_params</span><span class="pun">));</span><span class="pln"><br>$arr_params</span><span class="pun">=</span><span class="pln">array</span><span class="pun">(</span><span class="pln">$str_file_name</span><span class="pun">,</span><span class="pln"> </span><span class="str">'HEADER:Content-Type'</span><span class="pun">=&gt;</span><span class="str">'application/json'</span><span class="pun">);</span><span class="pln"><br>$str_rtn</span><span class="pun">=</span><span class="pln">post_to_host</span><span class="pun">(</span><span class="pln">$str_url_target</span><span class="pun">,</span><span class="pln"> $arr_params</span><span class="pun">,</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">,</span><span class="pln"> </span><span class="lit">3</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//POST with custom headers:</span><span class="pln"><br>$arr_params</span><span class="pun">=</span><span class="pln">array</span><span class="pun">(</span><span class="str">'para1'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'para2'</span><span class="pun">=&gt;</span><span class="str">'...'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'HEADER:username'</span><span class="pun">=&gt;</span><span class="str">'peter'</span><span class="pun">,</span><span class="pln"> </span><span class="str">'HEADER:password'</span><span class="pun">=&gt;</span><span class="str">'google'</span><span class="pun">);</span><span class="pln"><br>$str_rtn</span><span class="pun">=</span><span class="pln">post_to_host</span><span class="pun">(</span><span class="pln">$str_url_target</span><span class="pun">,</span><span class="pln"> $arr_params</span><span class="pun">,</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//POST with specified IP:</span><span class="pln"><br>$GLOBALS</span><span class="pun">[</span><span class="str">'POST_TO_HOST.HOSTS'</span><span class="pun">][</span><span class="str">'www.domain1.com'</span><span class="pun">]=</span><span class="pln">gethostbyname</span><span class="pun">(</span><span class="str">'www.domain1.com'</span><span class="pun">);</span><span class="com">//or '11.12.13.14'</span><span class="pln"><br>post_to_host</span><span class="pun">(</span><span class="str">'http://www.domain1.com/login.php'</span><span class="pun">,</span><span class="pln"> $arr_params</span><span class="pun">,</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">);</span><span class="pln"><br><br></span><span class="com">//POST with specified proxy domain or proxy IP:</span><span class="pln"><br>$GLOBALS</span><span class="pun">[</span><span class="str">'POST_TO_HOST.HOSTS'</span><span class="pun">][</span><span class="str">'www.domain1.com'</span><span class="pun">]=</span><span class="str">'www.proxy1.com:8080'</span><span class="pun">;</span><span class="com">//or '11.12.13.14:8080'</span><span class="pln"><br>post_to_host</span><span class="pun">(</span><span class="str">'http://www.domain1.com/login.php'</span><span class="pun">,</span><span class="pln"> $arr_params</span><span class="pun">,</span><span class="pln"> $arr_cookie</span><span class="pun">,</span><span class="pln"> $str_url_referer</span><span class="pun">,</span><span class="pln"> $ref_arr_head</span><span class="pun">);</span></pre><p>variable prefix explanation: </p><ul><li>'arr<i>' means any array, such as: array('var1'=&gt;'val1', 'var2'=&gt;'val2'), or empty one: array() </i></li><li><i>'ref_arr' means any array returned after post_to_host executed, you don't need define it in advance, print it:var_export($ref_arr_head) </i></li><li><i>'str</i>' means any string, such as: '<a href="http://www.google.com" rel="nofollow">http://www.google.com</a>', or empty one: '' </li></ul><p></p>

